USE ROLE ACCOUNTADMIN;
USE DATABASE ACOLYTE_DB;
USE SCHEMA DEV;
USE WAREHOUSE ACOLYTE_WH;


SELECT * FROM ACOLYTE_DB.DEV.EPISODES;

SELECT
    NO,
    REPLACE(TITLE, '"', '') as TITLE,
    DIRECTED_BY,
    WRITTEN_BY,
    TO_DATE(ORIGINAL_RELEASE_DATE, 'MMMM DD, YYYY') as ORIGINAL_RELEASE_DATE,
    PLOT,
      CONCAT(
        'The Acolyte, eposode ' || NO,
        ', directed by ' || DIRECTED_BY,
        ', written by ' || WRITTEN_BY,
        ', released on ' || ORIGINAL_RELEASE_DATE,
        '\n\n\nPlot: \n' || PLOT
      ) as listing_text
FROM ACOLYTE_DB.DEV.EPISODES
;


CREATE OR REPLACE CORTEX SEARCH SERVICE ACOLYTE_DB.DEV.ACOLYTE_PLOT_SVC_EPISODES
ON listing_text
ATTRIBUTES NO, TITLE, DIRECTED_BY, WRITTEN_BY
WAREHOUSE = ACOLYTE_WH
TARGET_LAG = '1 hour'
AS
SELECT 
    NO,
    REPLACE(TITLE, '"', '') as TITLE,
    DIRECTED_BY,
    WRITTEN_BY,
    TO_DATE(ORIGINAL_RELEASE_DATE, 'MMMM DD, YYYY') as ORIGINAL_RELEASE_DATE,
    CONCAT(
        'The Acolyte, eposode ' || NO,
        ', directed by ' || DIRECTED_BY,
        ', written by ' || WRITTEN_BY,
        ', released on ' || ORIGINAL_RELEASE_DATE,
        '\n\n\nPlot: \n' || PLOT
    ) as listing_text
FROM ACOLYTE_DB.DEV.EPISODES
;


SHOW CORTEX SEARCH SERVICES;
DESCRIBE CORTEX SEARCH SERVICE ACOLYTE_DB.dev.ACOLYTE_PLOT_SVC_EPISODES;
-- DROP CORTEX SEARCH SERVICE ACOLYTE_DB.dev.ACOLYTE_PLOT_SVC_EPISODES;
